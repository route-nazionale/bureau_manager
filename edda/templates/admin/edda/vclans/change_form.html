{% extends "admin/change_form.html" %}

{% block submit_buttons_bottom %}
    {{ block.super }}
    {% if change %}
        {% if original.arrivato_al_campo %}
            <button name="_check_in_quartiere" href="do-check-in-quartiere/" class="btn btn-high btn-success bureau-buttons" type="submit">CONFERMA L'ARRIVO DI TUTTI AL QUARTIERE</button>
        {% else %}
            <button name="_set_retired_campo" href="do-set-retired-campo/" class="btn btn-high btn-danger bureau-buttons" type="submit">RITIRA IL CLAN DALLA ROUTE</button>
        {% endif %}

    <script type="text/javascript">
        $('.bureau-buttons').click(function (e) {
            var el = $(e.target);
            $.post(el.attr('href'), {})
                .done(function(data) {
                    if (data != "OK") {
                        alert("Non hai i permessi necessari per eseguire l'operazione");
                    } else {
                        alert('Operazione "' + el.text() + '" eseguita con successo!');
                        $(el).remove();
                    }
                })
                .fail(function(data) {
                    alert("Non hai i permessi necessari per eseguire l'operazione");
                });
        
            e.stopPropagation();
            return false;
        });
    </script>
    {% endif %}
{% endblock %}

{% block object-tools %} {# nascondiamo il blocco #} {% endblock %}

{% block object-tools-items %}
    <!-- <li><a href="do-check-in-campo/" class="actionlink" dove="CAMPO"><i
        class="icon-time icon-alpha75"></i>Imposta arrivo al CAMPO</a>
    </li> -->
{% endblock %}
